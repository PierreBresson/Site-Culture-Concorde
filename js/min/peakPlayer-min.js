!function(){window.peakPlayer=function(t,n){this.defaults={autoPlay:!1,loop:!1,volume:100,songClass:"oneSound",random:!1},this.idPrefix="song-",this.songs=[],this.song=!1,this.lastSong=!1,this.songIndex=0,this.mute=!1,this.loop=!0,this.random=!1,this.options=t||this.defaults,this.sm=this.getSoundManager(),this.setSoundManager(this.sm),"undefined"!=typeof n?this.addArraySongs(n):"function"==typeof this.parsePageSongs&&this.parsePageSongs("oneSong")},peakPlayer.prototype={getSoundManager:function(){return window.soundManager?window.soundManager:!1},setSoundManager:function(t){t&&(t.url="js/soundmanager/swf/",t.flashVersion=9,t.debugMode=!0,t.preferFlash=!1,t.flashPollingInterval=1e3,t.waitForWindowLoad=!0,t.flash9Options.useEQData=!0,t.flash9Options.usePeakData=!0)},addSongs:function(t){for(var n={},s=this,o=this.songs.length,i=t.length,e=0;i>e;e++)this.searchSong(t[e].url)||(n.name=t[e].name,n.url=t[e].url,n.index=o,n.id=this.idPrefix+o,n.smObject=!1,this.songs.push(n),n={},o++)},addSong:function(t,n){return"undefined"!=typeof t&&"undefined"!=typeof n?(this.addSongs([{name:t,url:n}]),!0):!1},searchSong:function(t,n){for(var s=this.songs.length-1;s>=0;s--)if(this.songs[s].url===t)return"undefined"!=typeof n&&n===!0?s:!0;return!1},setSong:function(t){t!==this.song.index&&(this.lastSong=this.song,this.song=this.songs[t])},getSoundIndex:function(t,n){for(var s=n.length,o=0;s>o;o++)if(n[o].url.toString()===t.toString())return n[o].index;return!1},playSong:function(t){var n=this;"undefined"==typeof t&&(t=this.song&&this.song.smObject?this.song.index:0),this.setSong(t),!1===this.song||!1!==this.song&&!1===this.song.smObject?(!1!==this.lastSong&&!1!==this.lastSong.smObject&&this.stopSong(this.lastSong),this.song.smObject=this.sm.createSound({id:n.song.id,url:n.song.url,valume:n.options.volume,whileplaying:function(){if("function"==typeof n.whilePlaying){var t=n.secondsToTime(this.position/1e3),s=n.secondsToTime(this.durationEstimate/1e3),o=this.position/this.durationEstimate*100;n.whilePlaying(this,{elapsedTime:t,totalTime:s},o)}},whileloading:function(){if("function"==typeof n.whilePlaying){var t=this.bytesLoaded/this.bytesTotal*100;n.whileLoading(this,t)}2===this.readyState&&(n.songs.splice(n.song.index,1),n.onPlayOrPause(),n.loadingFailed(this))},onfinish:function(){n.onPlayOrPause(),"function"==typeof n.onFinish&&n.onFinish(this)},onid3:function(){n.onid3(this)},onbufferchange:function(){2===this.readyState&&(alert("loading failed"),n.songs.splice(n.song.index,1),n.onPlayOrPause(),n.loadingFailed(this))}}),this.song.smObject.play()):!1!==this.song&&!1!==this.song.smObject&&(!1!==this.lastSong&&!1!==this.lastSong.smObject&&this.stopSong(this.lastSong),this.song.smObject.togglePause()),this.onPlayOrPause(),"function"==typeof this.performThemeRelatedTasks&&this.performThemeRelatedTasks(t)},stopThatSong:function(){!1!==this.song&&!1!==this.song.smObject&&(!1!==this.lastSong&&!1!==this.lastSong.smObject&&this.stopSong(this.lastSong),this.song.smObject.togglePause()),this.onPlayOrPause()},stopSong:function(t){t.smObject.stop(),t.smObject.setPosition(0)},loadingFailed:function(t){this.nextTrack()},onPlayOrPause:function(){this.mute?this.song.smObject.setVolume(0):this.song.smObject.setVolume(100),this.song.smObject.paused?"function"==typeof this.onPause&&this.onPause(this.song):"function"==typeof this.onPlay&&this.onPlay(this.song)},playTrack:function(t,n){if("undefined"!=typeof t&&"undefined"!=typeof n){var s={name:t,url:n};this.addArraySongs([s]),this.playSong(this.searchSong(n,!0))}else"undefined"!=typeof t&&"undefined"==typeof n?this.playSong(t):this.playSong()},nextTrack:function(){this.playSong(this.getNextSongIndex())},previousTrack:function(){this.playSong(this.getPreviousSongIndex())},onid3:function(t){},getPlaylist:function(){return this.songs},getCurrentSong:function(){return this.song},seekToPosition:function(t,n){t=t/n*100;var s=this.song.smObject.durationEstimate/100*t;this.song.smObject.setPosition(s)},toggleMute:function(){this.song.smObject.volume<100?(this.song.smObject.setVolume(100),this.mute=!1):(this.song.smObject.setVolume(0),this.mute=!0)},toggleLoop:function(){this.options.loop?this.options.loop=!1:this.options.loop=!0},toggleRandom:function(){this.options.random?this.options.random=!1:this.options.random=!0},getNextSongIndex:function(){return this.song.smObject?!0===this.options.random&&!0!==this.options.loop?this.getRandomSongIndex():!0===this.options.loop?this.song.index:this.songs.length-1>this.song.index?this.song.index+1:0:0},getRandomSongIndex:function(){for(var t=Math.floor(Math.random()*this.songs.length);this.song.index===t;)t=Math.floor(Math.random()*this.songs.length);return t},getPreviousSongIndex:function(){return this.song.smObject?0===this.song.index?this.songs.length-1:this.song.index-1:void 0},secondsToTime:function(t){var n=t%3600,s=Math.floor(n/60),o=n%60,i=Math.ceil(o);i>59&&(s++,i=0),10>i&&(i="0"+i),10>s&&(s="0"+s);var e={m:s,s:i};return e},getHTMLPlaylist:function(t,n,s){t=t||"",n=n||"",s=s||"";var o=this.getPlaylist(),i=o.length,e=[],a=document.createElement("ul");a.id=t,a.className=n;for(var h=0;i>h;h++){var g=document.createElement("li");g.className=s,g.innerHTML=o[h].name,g.id=o[h].id,a.appendChild(g)}return a}}}();